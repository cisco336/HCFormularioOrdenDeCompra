<div class="the-wrapper">
  <div>
    <h1>
      <span>Proveedor:</span
      ><span>{{ proveedorControl || "Nombre del proveedor" }}</span>
    </h1>
    <button mat-mini-fab color="accent">
      <mat-icon>help_outline</mat-icon>
    </button>
  </div>
  <mat-card class="mat-elevation-z4 first">
    <div [formGroup]="mainFilterForm">
      <mat-form-field class="example-full-width">
        <input
          type="text"
          placeholder="Proveedor"
          aria-label="Proveedor"
          matInput
          required
          formControlName="proveedorControl"
          [matAutocomplete]="proveedor"
        />
        <mat-autocomplete
          #proveedor="matAutocomplete"
          [displayWith]="displayProveedor"
        >
          <mat-option
            *ngFor="let option of filteredProveedores | async"
            [value]="option"
          >
            {{ option.DESCRIPCION }}
          </mat-option>
        </mat-autocomplete>
        <mat-error>Campo requerido.</mat-error>
      </mat-form-field>
      <mat-form-field class="example-full-width">
        <input
          type="text"
          placeholder="Estados"
          aria-label="Estados"
          matInput
          required
          formControlName="estadosControl"
          [matAutocomplete]="estados"
        />
        <mat-autocomplete
          #estados="matAutocomplete"
          [displayWith]="displayEstados"
        >
          <mat-option
            *ngFor="let option of filteredEstados | async"
            [value]="option"
          >
            {{ option.DESCRIPCION }}
          </mat-option>
        </mat-autocomplete>
        <mat-error>Campo requerido.</mat-error>
      </mat-form-field>
     
      <mat-form-field>
        <input
          matInput
          required
          [matDatepicker]="dp1"
          placeholder="Fecha inicio"
          formControlName="fechaInicioControl"
        />
        <mat-datepicker-toggle matSuffix [for]="dp1"></mat-datepicker-toggle>
        <mat-datepicker #dp1></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <input
          matInput
          required
          [matDatepicker]="dp2"
          placeholder="Fecha fin"
          formControlName="fechaFinControl"
        />
        <mat-datepicker-toggle matSuffix [for]="dp2"></mat-datepicker-toggle>
        <mat-datepicker #dp2></mat-datepicker>
      </mat-form-field>
    </div>
    <button
      mat-raised-button
      color="primary"
      [disabled]="mainFilterForm.invalid"
      (click)="consultar($event)"
    >
      <mat-icon>search</mat-icon> Consultar
    </button>
  </mat-card>
  <mat-card class="mat-elevation-z4 second">
    <div>
      <h2>Opciones:</h2>
      <div>
        <button
          mat-raised-button
          color="accent"
          (click)="openDialogCambioEstado($event)"
          [disabled]="!selection.selected.length"
        >
          <mat-icon>category</mat-icon>Cambiar estado
        </button>
        <button mat-raised-button color="primary" #exportButton>
          <mat-icon>description</mat-icon>Generar reporte
        </button>
      </div>
    </div>
    <mat-form-field class="filter">
      <input
        matInput
        (keyup)="applyFilter($event.target.value)"
        placeholder="Filter"
      />
      <mat-icon matSuffix>filter_list</mat-icon>
    </mat-form-field>
    <!-- Tabla de datos Principal -->
    <table
      #table
      mat-table
      #table
      [dataSource]="dataSource"
      ngxMatTableExporter
      multiTemplateDataRows
      [cdkTable]="table"
      [exporterButton]="exportButton"
      sheetName="Ordenes_de_compra"
      fileName="Ordenes_de_compra"
    >

      <!-- Checkbox Column -->
      <ng-container matColumnDef="Select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? masterToggle() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
            [aria-label]="checkboxLabel()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
            [aria-label]="checkboxLabel(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Orden -->
      <ng-container matColumnDef="Orden">
        <th mat-header-cell *matHeaderCellDef># Orden</th>
        <td
          mat-cell
          *matCellDef="let element"
          class="position-label"
          (click)="openDialogDetalles(element)"
        >
          {{ element.Orden }}
        </td>
      </ng-container>

      <!-- Fecha Creación -->
      <ng-container matColumnDef="Fecha_creacion">
        <th mat-header-cell *matHeaderCellDef>Fecha creación</th>
        <td mat-cell *matCellDef="let element">{{ element.Fecha_creacion }}</td>
      </ng-container>

      <!-- Fecha  Despacho-->
      <ng-container matColumnDef="Fecha_despacho">
        <th mat-header-cell *matHeaderCellDef>Fecha despacho</th>
        <td mat-cell *matCellDef="let element">{{ element.Fecha_despacho }}</td>
      </ng-container>

      <!-- Fecha Entrega -->
      <ng-container matColumnDef="Fecha_entrega">
        <th mat-header-cell *matHeaderCellDef>Fecha entrega</th>
        <td mat-cell *matCellDef="let element">{{ element.Fecha_entrega }}</td>
      </ng-container>

      <!-- Detalles -->
      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let element"
          [attr.colspan]="displayedColumns.length"
        >
          <div
            class="element-detail "
            [@detailExpand]="
              element == expandedElement ? 'expanded' : 'collapsed'
            "
          >
            <div class="element-diagram">
              <div class="element-position">{{ element["Orden"] }}</div>
              <div class="element-symbol">
                {{ element["Orden"] }}
              </div>
              <div class="element-name">{{ element["Orden"] }}</div>
              <div class="element-weight">
                {{ element["Fecha_creacion"] }}
              </div>
            </div>
            <div class="element-description">
              {{ element["Fecha_entrega"] }}
              <span class="element-description-attribution">
                -- Wikipedia
              </span>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let element; columns: displayedColumns"
        class="element-row"
        [class.expanded-row]="expandedElement === element"
        (dblclick)="expandedElement = expandedElement === element ? null : element"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        class="detail-row"
      ></tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 20, 50, 100]"
      showFirstLastButtons
    ></mat-paginator>
  </mat-card>
</div>
